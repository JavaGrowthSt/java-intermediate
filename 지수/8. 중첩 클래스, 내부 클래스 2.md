# 지역 클래스 - Local class
내부 클래스의 특별한 종류 중 하나 -> 내부 클래스의 특징을 그대로 가진다.
> 바깥 클래스의 인스턴스 멤버에 접근 가능

### 특징
- 코드 블럭 안에 클래스를 선언한다.
  - like 지역 변수
- 지역 변수에 접근 가능하다.

### 접근 범위
- 자신의 인스턴스 변수인 `value`에 접근 가능
- `localVar`, `paramVar`, `outInstanceVar`에 접근 가능
  - `localVar` : 자신이 속한 코드 블럭의 지역 변수
  - `paramVar` : 자신이 속한 코드 블럭의 매개변수
  - `outInstanceVar` : 바깥 클래스의 인스턴스 멤버

> 지역 클래스는 접근 제어자를 사용할 수 없다.

### 지역 클래스 인스턴스의 생존 범위
- 지역 클래스로 만든 객체도 인스턴스이기 때문에 힙 영역에 존재한다. -> GC 전까지 생존
- 지역 변수는 메서드가 실행되는 동안에만 스택 영역에 생존한다.
  - 메서드가 종료되면 해당 스택 프레임이 스택 영역에서 제거 되면서 함께 제거된다.

### 캡처
지역 클래스는 지역 변수에 접근 가능하다. But, 지역 변수의 생명주기는 짧고, 지역 클래스를 통해 생성한 인스턴스의 생명 주기는 길다.
<br><br>
지역 클래스를 통해 생성한 인스턴스가 지역 변수에 접근해야 하는데, 둘의 생명 주기가 다르다. -> 인스턴스는 살아있는데 지역변수는 제거된 상태일 수 있다.
<br><br>
자바에서 이러한 문제를 해결하기 위해 **지역 클래스의 인스턴스를 생성하는 시점에 필요한 지역 변수를 복사해서 생성한 인스턴스에 함께 넣어둔다.**

- 인스턴스를 생성할 때, 필요한 지역 변수를 복사해서 보관해 두는 것
- 접근이 필요한 지역변수만 캡쳐한다.
- 지역 클래스가 접근하는 지역변수는 final로 선언하거나, 사실상 final이어야 한다.

> **사실상 final (effectively final)**
> 지역 변수에 final 키워드를 사용하지 않았지만, 값을 변경하지 않는 지역 변수

#### 사실상 final이어야 하는 이유
- 지역 변수의 값을 변경하면 인스턴스에 캡처한 변수의 값도 변경해야 한다.
- 인스턴스에 있는 캡처 변수의 값을 변경하면 해당 지역 변수의 값도 다시 변경해야 한다.
- 예상하지 못한 곳에서 값이 변경될 수 있기 때문에 디버깅이 어려워진다.
- 지역 변수의 값과 인스턴스에 있는 캡처 변수의 값을 서로 동기화 해야 하는데, 멀티쓰레드 상황에서 이런 동기화
는 매우 어렵고, 성능에 나쁜 영향을 줄 수 있다.

> 캡처한 지역변수의 값을 불변으로 만들어서 복잡한 문제들의 발생을 근본적으로 차단한다!

# 익명 클래스 
- 지역 클래스의 특별한 종류 중 하나
- 이름이 없는 지역 클래스

### 특징
- 이름 없는 지역 클래스를 선언하면서 동시에 생성
- 부모 클래스를 상속 받거나 인터페이스를 구현해야 한다.
  - 익명 클래스를 사용할 때는 상위 클래스나 인터페이스가 필요함
- 생성자를 가질 수 없다. (기본 생성자만 사용된다.)
- AnonymousOuter$1 과 같이 자바 내부에서 바깥 클래스 이름 + $ + 숫자로 정의된다.
  - 여러개이면 $1 , $2 , $3 으로 숫자가 증가하면서 구분된다
 

### 장점
- 클래스를 별도로 정의하지 않고도 인터페이스나 추상 클래스를 즉석에서 구현할 수 있어 코드가 더 간결해진다.
  - 복잡하거나 재사용이 필요한 경우는 별도 클래스를 정의하는 것이 좋다.
